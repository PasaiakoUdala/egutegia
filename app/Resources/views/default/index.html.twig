{% extends 'base.html.twig' %}

{% block content_div_start %}{% endblock %}
{% block content_div_end %}{% endblock %}
{% block headline %}{{ 'Langileen zerrenda' | trans }} {% endblock %}

{% block content_row %}
    <div id="toolbar">
        <button id="btnBerria" class="btn btn-default">Txantiloi berria</button>
    </div>
    <table id="table"
            {#data-toggle="table"#}
           data-classes="table table-hover table-condensed"
           data-striped="true"

           data-pagination="true"
           data-search="true"
           data-height="300"

           data-sort-name="name"
           data-sort-order="asc"

           data-icon-size="sm"
           data-show-refresh="true"
           data-show-toggle="true"
           data-show-columns="true"

           data-toolbar="#toolbar"
           data-show-export="true"
           data-export-types="['csv','excel', 'pdf']"
           data-export-options='{
                 "fileName": "export",
                 "worksheetName": "export",
                 "jspdf": {
                   "autotable": {
                     "styles": { "rowHeight": 20, "fontSize": 10 },
                     "headerStyles": { "fillColor": 255, "textColor": 0 },
                     "alternateRowStyles": { "fillColor": [60, 69, 79], "textColor": 255 }
                   }
                 }
               }'>

        <thead>
        <tr>
            <th data-halign="left" data-align="left" data-field="firstName"
                data-sortable="true">{{ 'Nombre' | trans }}</th>
            <th data-halign="left" data-align="left" data-field="lastName"
                data-sortable="true">{{ 'Abizenak' | trans }}</th>
            <th data-halign="left" data-align="left">{{ 'Egutegia' | trans }}</th>
            <th data-halign="left" data-align="left">{{ 'Txantiloia' | trans }}</th>
            <th data-halign="left" data-align="left">{{ 'Urteko orduak' | trans }}</th>
            <th data-halign="center" data-align="center">{{ 'Opor orduak' | trans }}</th>
            <th data-halign="center" data-align="center">{{ 'Norberarentzako orduak' | trans }}</th>
            <th data-halign="center" data-align="center">{{ 'Konpentsatutako orduak' | trans }}</th>
        </tr>
        </thead>
        <tbody>
        {% for user in userdata if user.user.has('firstName') and user.user.has('lastName') %}
            <tr>
                <td>{% if user.user.has('firstName') %}{{ user.user.get('firstName') }}{% endif %}</td>
                <td>{% if user.user.has('lastName') %}{{ user.user.get('lastName') }}{% endif %}</td>
                {% if user.calendar %}
                    <td>
                        <a href="{{ path('admin_calendar_edit', { 'id': user.calendar[0].id }) }}">{{ user.calendar[0] }}</a>
                    </td>
                    <td>
                        <a href="{{ path('admin_template_edit', { 'id': user.calendar[0].template.id }) }}">{{ user.calendar[0].template }}</a>
                    </td>
                    <td>{{ user.calendar[0].hoursYear }} / {{ user.calendar[0].template.hoursYear }}</td>
                    <td>{{ user.calendar[0].hoursFree }} / {{ user.calendar[0].template.hoursFree }}</td>
                    <td>{{ user.calendar[0].hoursSelf }} / {{ user.calendar[0].template.hoursSelf }}</td>
                    <td>{{ user.calendar[0].hoursCompensed }} </td>
                {% else %}
                    <td>
                        <a href="javascript:void(0);" class="btnNewCalendar btn btn-primary btn-xs"
                           data-username="{{ user.user.username }}">
                            <i class="fa fa-plus-square-o" aria-hidden="true"> Sortu</i>
                        </a>
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="modal fade" id="new-modal" tabindex="-1" role="dialog" aria-labelledby="Modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span
                                class="sr-only">{{ 'Itxi' | trans }}</span></button>
                    <h4 class="modal-title">
                        {{ 'Egutegi berria: ' | trans }}
                    </h4>
                </div>
                <div class="modal-body" id="divModalCalendarNew">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{ 'Ezeztatu' | trans }}</button>
                    <button type="button" class="btn btn-primary" id="btnGordeModal">
                        {{ 'Gorde' | trans }}
                    </button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}
{% block foot_script %}
    {{ parent() }}
    <script>
        var $table = $('#table'), selections = [];
        function initTable() {
            $table.bootstrapTable({
                height: getHeight()
            });
        }
        function getHeight() {
            var winh = $(window).height();
            var h2h = $('h2').outerHeight(true);
            var fooh = $('footer').outerHeight(true);
            return winh - h2h - fooh - 200;
        }

        $(function () {
            initTable();
            $('.btnNewCalendar').on('click', function () {
                $('#divModalCalendarNew').empty();
                var myusername = $(this).data('username');
                var url = Routing.generate('admin_calendar_new', {username: myusername});
                $('#divModalCalendarNew').load(url, function () {
                    $('#appbundle_calendar_template').append("<option value='-1' selected>Aukeratu bat</option>");
                    $('#new-modal').modal();
                });
            });

            $(document).on('click', '#appbundle_calendar_template', function () {
                var val = $(this).val();
                if (val !== "-1") {
                    var url = Routing.generate('get_template', {'id': val});
                    $.ajax({
                        url: url,
                        data: {
                            format: 'json'
                        },
                        success: function (result) {
                            $('#appbundle_calendar_hoursYear').val(result.hours_year);
                            $('#appbundle_calendar_hoursFree').val(result.hours_free);
                            $('#appbundle_calendar_hoursSelf').val(result.hours_self);
                        },
                        error: function () {
                            console.log("HORROR!");
                        }
                    });
                }
            });

        });
    </script>
{% endblock %}