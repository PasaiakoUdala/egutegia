{% extends 'base.html.twig' %}

{% block headline %}{{ 'Eskaeren zerrenda' | trans }} {% endblock  %}

{% block content_row %}

    <div class="row">
        <div class="col-md-2">
            <a class="btn btn-primary" href="{{ path('eskaera_new') }}">Eskaera berria</a>
        </div>
        <div class="col-md-10"></div>
    </div>
    <div class="row">&nbsp;</div>
    <div class="row">
        <div class="col-md-12">
            <table id="tableEskaerak" class="table table-bordered table-striped table-hover table-condensed"
                   data-toggle="table"
                   data-toolbar="#toolbar"
                   data-height="460"
                   data-detail-view="true"
                   data-detail-formatter="detailFormatter"
            >
                <thead>
                <tr>
                    <th data-field="id">ID</th>
                    <th>Izaera</th>
                    <th>Egutegia</th>
                    <th>Hasi</th>
                    <th>Amaitu</th>
                    <th>Orduak/Egunak</th>
                    <th>Bideratua</th>
                    <th>Gauzatua</th>
                    <th>Sinatzaileak</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for eskaera in eskaeras %}
                    <tr {% if eskaera.oharra | length > 0 %} class="danger" {% endif %}>
                        <td>{{ eskaera.id }}</td>
                        <td><a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">{{ eskaera.name }}</a></td>
                        <td><a href="{{ path('admin_calendar_edit', { 'id': eskaera.calendar.id }) }}" target="_blank">{{ eskaera.calendar.name }}</a></td>
                        <td><a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">{% if eskaera.hasi %}{{ eskaera.hasi|date('Y-m-d') }}{% endif %}</a></td>
                        <td><a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">{% if eskaera.amaitu %}{{ eskaera.amaitu|date('Y-m-d') }}{% endif %}</a></td>
                        <td><a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">{{ eskaera.orduak }}</a></td>
                        <td>
                            <a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">
                                {% if eskaera.abiatua == true %}
                                    <label class="label label-success">Bai</label>
                                {% else %}
                                    <label class="label label-danger">Ez</label>
                                {% endif %}
                            </a>
                        </td>
                        <td>
                            <a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">
                                {% if eskaera.amaitua == true %}
                                    <label class="label label-success">Bai</label>
                                {% else %}
                                    <label class="label label-danger">Ez</label>
                                {% endif %}
                            </a>
                        </td>
                        <td><a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}">{{ eskaera.sinatzaileak }}</a></td>

                        <td>
                            <ul class="list-inline text-center">
                                <li>
                                    <a href="{{ path('eskaera_show', { 'id': eskaera.id }) }}"><i class="fa fa-eye" aria-hidden="true"></i></a>
                                </li>
                                <li>
                                    {{ form_start(deleteForms[eskaera.id],{'attr': {'id': eskaera.id}}) }}
                                    <a class="btnRemoveRow" data-id="{{ eskaera.id }}" href="#eskaeraEditModal{{ eskaera.id }}">
                                        <i class="fa fa-trash text-danger" aria-hidden="true"></i>
                                    </a>
                                    {{ form_end(deleteForms[eskaera.id]) }}
                                </li>
                                <li>
                                    <a href="#eskaeraEditModal{{ eskaera.id }}" data-toggle="modal" data-target="#eskaeraEditModal{{ eskaera.id }}"><i class="fa fa-paper-plane" aria-hidden="true"></i></a>
                                </li>
                            </ul>
                            <div class="modal modal-fade" id="eskaeraEditModal{{ eskaera.id }}">
                                <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content">

                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span
                                                    class="sr-only">{{ 'Itxi' | trans }}</span></button>
                                        <h4 class="modal-title">
                                            <strong>{{ eskaera.name }}</strong> eskaera aldatzen
                                        </h4>
                                    </div>

                                    <div class="modal-body">
                                        {{ render(controller('AppBundle:Eskaera:edit', {'id': eskaera.id})) }}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">{{ 'Ezeztatu' | trans }}</button>
                                        <button type="button" class="btn btn-primary saveEditModal" data-id="{{ eskaera.id }}">
                                            {{ 'Gorde' | trans }}
                                        </button>
                                    </div>
                                </div>
                                </div>
                            </div>

                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="6"> Ez dago daturik</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>




{% endblock %}

{% block foot_script %}
    {{ parent() }}
    <script >
      const $table = $('#tableEskaerak');

      $( document ).ready(function() {

        $table.bootstrapTable();
        $table.on('expand-row.bs.table', function (e,index, row, $detail) {
          const miid = row.id
          const url = Routing.generate('get_firmatzaileak', {'eskaeraid':miid})

          $detail.html('toc toc...' + url + ' helbideari deika');

          $.get(url, function (data) {
            console.log(data)
//            let html="<ul class='list-group'>";
            let html="<div class='row'>" +
              "<div class='col-md-2'></div>" +
              "<div class='col-md-8'>" +
              "<table class='table table-bordered table-striped table-hover table-condensed'><thead><tr><th><strong>Erabiltzailea</strong></th><th><strong>Firmatua</strong></th></tr></thead><tbody>";
            $.each(data, function(i, obj)
            {

//              html =html+"<ul class='list-inline'><li>" + obj.user.username + "</li>";
              html =html+"<tr'><td>" + obj.user.username + "</td>";


              if ( obj.firmatua === false ) {
//                html = html + "<li class='label-danger'>Firmatzeke</li></ul>";
                html = html + "<td>Firmatzeke</td></tr>";
              } else {
//                html = html + "<li class='label-success'>Firmatua</li></ul>";
                html = html + "<td>Firmatua</td></tr>";
              }


            })

//            html = html + "</ul>";
            html = html + "</tbody></table>" +
              "<div class='col-md-2'></div>" +
              "</div>";


            $detail.html(html);
          });
        });


        $('.saveEditModal').on('click', function() {
          const miid = $(this).data('id')
          const mifrm = $('#frmEditEskaera' + miid)
          $(mifrm).submit()
        })


        $('.btnRemoveRow').on('click', function () {
          const that = $(this);
          bootbox.confirm({
            title: "{{ 'Adi!' | trans }}",
            message: "{{ 'Ziur zaude ezabatu nahi duzula?' | trans }}",
            buttons: {
              cancel: {
                label: '<i class="fa fa-times"></i> {{ 'Ezeztatu' | trans }}'
              },
              confirm: {
                label: '<i class="fa fa-check"></i> {{ 'Onartu' | trans }}'
              }
            },
            callback: function (result) {
              if ( result === true ) {
                $(that).closest('form').submit();
              }
            }
          });
        });

      });
    </script>

{% endblock %}