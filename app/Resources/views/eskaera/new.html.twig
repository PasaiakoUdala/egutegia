{% extends 'base.html.twig' %}

{% block head_style %}

    {{ parent() }}
    <style>
        .datepicker table tr td.disabled,
        .datepicker table tr td.disabled:hover {
            color: #b90000;
        }
    </style>

{% endblock %}

{% block headline %}{{ eskaera.type.name ~ ' ' ~ 'eskaera berria' | trans  | lower}} {% endblock  %}

{% block content_row %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            {{ form_start(form, { 'attr': {'class': 'form-horizontal', 'id': 'frmEskaeraNew'} }) }}
            <div class="form-group">
                <label for="min-date" class="col-sm-4 control-label">{{ 'Langilea' | trans }}</label>
                <div class="col-sm-7">
                    {{ form_widget(form.name, { 'attr': {'class': 'form-control'} }) }}
                </div>
            </div>

            <div class="form-group">
                {% if 'KONPENTSA' not in eskaera.type.name | upper %}
                    <label for="min-date" class="col-sm-4 control-label">{{ 'Noiztik' | trans }}</label>
                {% else  %}
                    <label for="min-date" class="col-sm-4 control-label">{{ 'Eguna' | trans }}</label>
                {% endif %}
                <div class="col-sm-7">
                    {{ form_widget(form.hasi, { 'attr': {'class': 'form-control cmbFetxaKalc'} }) }}
                </div>
            </div>

            {% if 'KONPENTSA' not in eskaera.type.name | upper %}
                <div class="form-group">
                    <label for="min-date" class="col-sm-4 control-label">{{ 'Noiz arte' | trans }}</label>
                    <div class="col-sm-7">
                        {{ form_widget(form.amaitu, { 'attr': {'class': 'form-control cmbFetxaKalc'} }) }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="min-date" class="col-sm-4 control-label">{{ 'Eskatutako <strong>egunak</strong>' | trans|raw }}</label>
                    <div class="col-sm-7">
                        {{ form_widget(form.egunak, { 'attr': {'class': 'form-control'} }) }}
                    </div>
                </div>
            {% endif %}


            <div class="form-group">
                <label for="min-date" class="col-sm-4 control-label">{{ 'Eskatutako <strong>orduak</strong>' | trans | raw }}</label>
                <div class="col-sm-7">
                    {{ form_widget(form.orduak, { 'attr': {'class': 'form-control cmbFetxaKalc'} }) }}
                </div>
            </div>

            {% if 'KONPENTSA' not in eskaera.type.name | upper %}
                <div class="form-group">
                    <div class="col-md-4"></div>
                    <div class="col-md-8">
                        <p>{{ 'Lanaldia' | trans }}: {{ eskaera.calendar.hoursDay }}</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="min-date" class="col-sm-4 control-label">{{ 'Guztira zenbat <strong>ordu</strong>' | trans | raw }}</label>
                    <div class="col-sm-7">
                        {{ form_widget(form.total, { 'attr': {'class': 'form-control disabled'} }) }}
                    </div>
                </div>
            {% endif %}

            <div class="form-group">
                {% if 'KONPENTSA' not in eskaera.type.name | upper %}
                    <label for="appbundle_eskaera_oharra" class="col-sm-4 control-label">{{ 'Deskribapena' | trans }}</label>
                {% else %}
                    <label for="appbundle_eskaera_oharra" class="col-sm-4 control-label">{{ 'Azalpena' | trans }}</label>
                {% endif %}
                <div class="col-sm-7">
                    {{ form_widget(form.oharra, { 'attr': {'class': 'form-control'} }) }}
                </div>
            </div>



            <div class="form-group">
                <label for="min-date" class="col-sm-4 control-label">{{ 'Eskaera data' | trans }}</label>
                <div class="col-sm-7">
                    {{ form_widget(form.noiz, { 'attr': {'class': 'form-control'} }) }}
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <button id="btnSubmit" type="button" class="btn btn-primary">{{ 'Eskaera gauzatu' | trans }}</button>
                </div>
                <div class="col-md-4"></div>
            </div>
            <div style="display: none">
                {{ form_end(form) }}
                <input id="txtJornada" type="text" value="{{ calendar.getHoursDay }}">
                <input id="hoursFree" type="text" value="{{ calendar.hoursFree }}">
                <input id="eskaeramota" type="hidden" value="{{ eskaera.type.name }}">
            </div>

        </div>
        <div class="col-md-2"></div>
    </div>


    <input type="hidden" id="txtJaiEgunak" value="{{ jaiegunak |  serialize('json') }}"/>


    <button id="button" class="btn btn-warning">Disable Dates</button>

{% endblock %}

{% block foot_script %}
    {{ parent() }}
    <script language="JavaScript">
        $('#btnSubmit').on('click', function () {
            var ongi = true;
            var eskaeramota = $('#eskaeramota').val();
            var konpentsatuada = false;
            if (eskaeramota.toUpperCase().indexOf("KONPENTSA") !==-1) {
                konpentsatuada = true;
            }

            if ($("input[type=radio]:checked").length === 0) {
                bootbox.alert('Mota zehaztea beharrezkoa da.');
                ongi = false;
                return;
            }

            var hasi = $("input[name='appbundle_eskaera[hasi]']").val();
            if (hasi.length === 0) {
                if (konpentsatuada === false) {
                    bootbox.alert('Noiztik zehaztea beharrezkoa da.');
                } else {
                    bootbox.alert('Eguna zehaztea beharrezkoa da.');
                }

                ongi = false;
                return;
            }

            if (konpentsatuada === false) {
                var amaitu = $("input[name='appbundle_eskaera[amaitu]']").val();
                if (amaitu.length === 0) {
                    bootbox.alert('Amaitu zehaztea beharrezkoa da.');
                    ongi = false;
                    return;
                }

                var egunak = $("input[name='appbundle_eskaera[egunak]']").val();
                if (egunak.length === 0) {
                    bootbox.alert('Egunak zehaztea beharrezkoa da.');
                    ongi = false;
                    return;
                }
            } else {
                var oharra = $("input[name='appbundle_eskaera[oharra]']").val();
                if (oharra.length === 0) {
                    bootbox.alert('Azalpena zehaztea beharrezkoa da.');
                    ongi = false;
                    return;
                }
            }


            var orduak = $("input[name='appbundle_eskaera[orduak]']").val();
            if (orduak.length === 0) {
                bootbox.alert('Orduak zehaztea beharrezkoa da.');
                ongi = false;
                return;
            }
            var noiz = $("input[name='appbundle_eskaera[noiz]']").val();
            if (noiz.length === 0) {
                bootbox.alert('Noiz zehaztea beharrezkoa da.');
                ongi = false;
                return;
            }


            if ( ongi ) {
                $('#frmEskaeraNew').submit();
            }


        });

        var jaiegunak = JSON.parse($("#txtJaiEgunak").val());
        var arrayJaiEgunak = [];

        $.each( jaiegunak, function( key, value ) {
            var nireFetxa = moment(value.start_date);
            arrayJaiEgunak.push(moment(nireFetxa).format("YYYY-MM-DD"));
        });

        $('#appbundle_eskaera_hasi').datepicker({
            autoclose: true,
            format: 'yyyy-mm-dd',
            datesDisabled: arrayJaiEgunak,
            daysOfWeekDisabled: '6,0',
            language: '{{ app.request.locale }}'
        });

        $('#appbundle_eskaera_amaitu').datepicker({
            autoclose: true,
            format: 'yyyy-mm-dd',
            datesDisabled: arrayJaiEgunak,
            daysOfWeekDisabled: '6,0',
            language: '{{ app.request.locale }}'
        });


    </script>
{% endblock %}


